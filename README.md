# An LLVM Front End for BCPL

## The Objective

This is work-in-progress to develop the above as a standard BCPL code generator.
That is, its API allows it to be used with the *SYN* and *TRN* phases distributed
as part of the standard distribution of the BCPL kit from Martin Richards.

This means:

- the source code is included in the same source file as SYN and TRN,
- the entry point is the function *codegenerate*, which expects the usual two arguments, the location of some workspace and its size,
- *codegenerate* used the function *rdn* defined by *SYN* to read the OCODE generated by *TRN*
- *codegenerate* translates the OCODE into optimised LLVM IR and writes the result to the stream *gostream*, opened by *SYN*.

The current target language and runtime is that specified by

    A PROPOSED DEFINITION OF THE LANGUAGE BCPL,
    M.D. Middleton, R. Firth, M. Richards, I. Willers,
    1st October 1979

up to but not including the appendix (which defines extensions). Once that
target has been reached, the appendix will be included (providing floating
point and the heap, among other things).

## The Current State of Play
The current state of play is that the compiler can now compile itself but
the result is not yet runnable as the source makes calls to the Sys global.

- It uses LLVM 20.1.3
- It is compiled using the cintpos BCPL compiler
- The resulting compiler runs under cintpos but generates standalone code
- The BCPL run time library is simply layered on top of the native C RTL for the time being
- Not all of the BCPL RTL is implemented
- The OCODE operations supporting SLCT are not implemented - specify noselst on the command line to compile BCPL programs using field selectors
- The BCPL standard requires arguments to routines to have adjacent addresses so that it is possible to take the address of the first argument and treat the argument as a vector. The code generator does not honour this.
- Much of CMPLTEST currently passes 
- According to section 2.4.5 of the BCPL Cintsys and Cintpos User Guide, local variables are allocated consecutive locations in the stack frame of the current function. The "Proposed Definition" does not mention this and the code generator does not honour it at the moment.

