# An LLVM Front End for BCPL

## The Objective

This is work-in-progress to develop the above as a standard BCPL code generator.
That is, its API allows it to be used with the *SYN* and *TRN* phases distributed
as part of the standard distribution of the BCPL kit from Martin Richards.

This means:

- the source code is included in the same source file as SYN and TRN,
- the entry point is the function *codegenerate*, which expects the usual two arguments, the location of some workspace and its size,
- *codegenerate* used the function *rdn* defined by *SYN* to read the OCODE generated by *TRN*
- *codegenerate* translates the OCODE into optimised LLVM IR and writes the result to the stream *gostream*, opened by *SYN*.

The current target language and runtime is that specified by

    A PROPOSED DEFINITION OF THE LANGUAGE BCPL,
    R. Firth, M. Richards, I. Willers,
    1st October 1979

up to but not including the appendix (which defines extensions). Once that
target has been reached, the appendix will be included (providing floating
point and the heap, among other things).

## History
As a proof of concept, the compiler running under CINTPOS and using LLVM 14
had compiled all of the program examples in the BCPL kit I've attempted and
the code generated was of the quality one would expect after passing though
the LLVM optimisation pipeline.

Alas, the one program that failed to compile is *TRN*, which makes use of
the ability to assigne a label to a variable and later GOTO that variable.
I was trying to discover how to use the LLVM indirect branch support.

## The Current State of Play

Also, over time, things have rotted: Martin Richards has changed things in
the distribution and the LLVM world has moved on, rewriting the optimisation
pipeline and making other changes which broke my code generator. The current
state of the repository reflects the broken state of the world.
